name: Test ELS Testplan Dashboard for Codespaces

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pytest flask-testing
    
    - name: Run basic tests
      run: |
        python -c "import app; print('âœ… App imports successfully')"
        python -c "from app import app; print('âœ… Flask app created successfully')"
    
    - name: Test Codespaces configuration
      run: |
        echo "âœ… Testing Codespaces configuration..."
        test -f .devcontainer/devcontainer.json && echo "âœ… devcontainer.json exists"
        test -f .devcontainer/setup.sh && echo "âœ… setup.sh exists"
        test -f GITHUB_CODESPACES_DEPLOYMENT.md && echo "âœ… Deployment guide exists"
    
    - name: Validate application structure
      run: |
        echo "âœ… Validating application structure..."
        test -d templates && echo "âœ… Templates directory exists"
        test -d uploads && echo "âœ… Uploads directory exists"
        test -f requirements.txt && echo "âœ… Requirements file exists"
        test -f app.py && echo "âœ… Main application file exists"

  codespaces-ready:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Verify Codespaces readiness
      run: |
        echo "ðŸš€ ELS Testplan Dashboard is ready for GitHub Codespaces!"
        echo ""
        echo "ðŸ“‹ To use the dashboard:"
        echo "1. Go to the repository on GitHub"
        echo "2. Click 'Code' â†’ 'Codespaces' â†’ 'Create codespace on main'"
        echo "3. Wait for automatic setup (2-3 minutes)"
        echo "4. Run: python app.py"
        echo "5. Open the forwarded port 5000"
        echo "6. Login with: admin / admin123"
        echo ""
        echo "ðŸ“– Full documentation: GITHUB_CODESPACES_DEPLOYMENT.md"
